name: "Pull and build translations"
on:
  workflow_dispatch:
  workflow_call:

jobs:
  pull-translations:
    if: github.repository == 'CleverRaven/Cataclysm-DDA'
    runs-on: ubuntu-latest
    steps:
      - name: install gettext tools
        run: sudo apt-get install gettext
      - name: "Install Transifex CLI"
        run: |
          curl -sL https://github.com/transifex/cli/releases/download/v1.6.17/tx-linux-amd64.tar.gz | sudo tar zxvf - -C /usr/bin tx
      - name: "Checkout"
        uses: actions/checkout@v4
      - name: "Pull translations"
        env:
          TX_TOKEN: ${{ secrets.TX_TOKEN }}
        run: tx pull --force
      - name: "Discard invalid translations"
        run: ./lang/discard_invalid_po.sh
      - name: "Update stats"
        run: ./lang/update_stats.sh
      - name: "Build translations"
        run: make localization LANGUAGES=all
      - name: "Store translation artifact"
        uses: actions/upload-artifact@v4
        with:
          name: "translations"
          path: "${{github.workspace}}/gfx/*"

        


